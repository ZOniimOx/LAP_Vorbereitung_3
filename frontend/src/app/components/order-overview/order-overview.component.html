<h1>Order Overview</h1>
<div #notification></div>
<kendo-dialog
  title="Create Order"
  *ngIf="createDialog.open"
  (close)="closeCreateDialog()"
  [width]="1200"
>
  <form class="k-form" [formGroup]="createDialog.formGroup!">
    <!-- <kendo-formfield>
      <kendo-label for="orderdate" text="Orderdate"></kendo-label>

      <kendo-label for="orderdate" text="Orderdate"></kendo-label>
      <kendo-datepicker
        formControlName="orderdate"
        format="dd.MMM.yyyy"
        [weekNumber]="true"
        [min]="now"
      >
      </kendo-datepicker>
      <kendo-combobox
        [data]="systemengineers.data"
        [textField]="'userName'"
        [valueField]="'staffno'"
        [allowCustom]="true"
        [virtual]="{ itemHeight: 28 }"
        [suggest]="true"
        [formControlName]="formEnum.engineeringstaffnr"
        [valuePrimitive]="true"
      ></kendo-combobox>
    </kendo-formfield> -->

    <kendo-formfield>
      <kendo-label for="reseller" text="Reseller"></kendo-label>
      <kendo-textbox
        id="resellerid"
        name="name"
        formControlName="resellername"
        [disabled]="true"
      >
        <!-- formControlName="reseller" -->
      </kendo-textbox>
    </kendo-formfield>
    <kendo-formfield>
      <kendo-label for="orderdate" text="Orderdate"></kendo-label>
      <kendo-datepicker
        formControlName="orderdate"
        format="dd.MM.yyyy"
        [min]="now"
      ></kendo-datepicker>
    </kendo-formfield>
    <!-- <kendo-formfield>
      <kendo-label for="modelname" text="PC"></kendo-label>
      <kendo-textbox formControlName="modelname"> </kendo-textbox>
    </kendo-formfield> -->
    <br />
    <kendo-grid
      [data]="createDialog.grid.gridView"
      [resizable]="true"
      (add)="createGridAddHandler($event)"
      (save)="createGridSaveHandler($event)"
      (cancel)="createGridCancelHandler($event)"
      (remove)="createGridRemoveHandler($event)"
    >
      <ng-template kendoGridToolbarTemplate>
        <button kendoGridAddCommand [primary]="true">Add new PC</button>
        <!-- <button kendoButton (click)="openCreateDialog()">Add New Order</button> -->
      </ng-template>
      <kendo-grid-command-column [width]="150">
        <ng-template kendoGridCellTemplate let-isNew="isNew" let-dataItem>
          <!-- <ng-container>
            <button kendoGridEditCommand [primary]="true">Edit</button>
          </ng-container> -->
          <button kendoGridRemoveCommand>Remove</button>
          <button
            kendoGridSaveCommand
            [primary]="true"
            [disabled]="createDialog.grid.formGroup.invalid"
          >
            <!-- [disabled]="!orderGrid.formGroup.valid" -->
            <!-- [disabled]="grid.formGroup.invalid" -->
            {{ isNew ? "Add" : "Update" }}
          </button>
          <button kendoGridCancelCommand>
            {{ isNew ? "Discard changes" : "Cancel" }}
          </button>
        </ng-template>
      </kendo-grid-command-column>
      <kendo-grid-column field="pc.modelname" title="PC" [width]="200">
        <ng-template kendoGridEditTemplate let-formGroup="formGroup">
          <kendo-combobox
            [data]="pcs"
            [allowCustom]="false"
            [formControl]="formGroup.get('pc')"
            [textField]="'modelname'"
            [valueField]="'pcid'"
            style="width: 100%"
          >
            <!-- (valueChange)="pcDropdownValueChange($event)" -->
            <!-- 
              [valuePrimitive]="true"
              [placeholder]="'Type to search for a user'" 
          [filterable]="true"
            (filterChange)="userComboBoxFilterChanged($event)" -->
          </kendo-combobox>
        </ng-template>
        <ng-template kendoGridCellTemplate let-dataItem>
          {{ dataItem.pc.modelname }}
        </ng-template>
      </kendo-grid-column>
      <kendo-grid-column
        field="quantity"
        title="Quantity"
        [width]="100"
      ></kendo-grid-column>
      <kendo-grid-column
        field="additionalparts"
        title="Additional Parts"
        [width]="150"
      ></kendo-grid-column>
      <kendo-grid-column
        field="pc.cpu"
        title="CPU"
        [editable]="false"
        [width]="70"
      ></kendo-grid-column>
      <kendo-grid-column
        field="pc.ramcapacity"
        title="RAM"
        [editable]="false"
        [width]="70"
      ></kendo-grid-column>
      <kendo-grid-column
        field="pc.microphone"
        title="Microphone"
        [editable]="false"
        [width]="100"
      ></kendo-grid-column>
      <kendo-grid-column
        field="pc.webcam"
        title="Webcam"
        [editable]="false"
        [width]="100"
      ></kendo-grid-column>
      <kendo-grid-column
        field="pc.price"
        title="Price"
        [editable]="false"
        [width]="100"
      ></kendo-grid-column>
      <kendo-grid-column
        field="pc.ssdcapacity"
        title="SSD"
        [editable]="false"
        [width]="100"
      ></kendo-grid-column>
    </kendo-grid>
  </form>
  <kendo-dialog-actions>
    <button kendoButton (click)="closeCreateDialog()">Cancel</button>
    <button kendoButton (click)="createOrder()" [primary]="true">
      Create Order
    </button>
  </kendo-dialog-actions>
</kendo-dialog>

<kendo-grid
  [data]="orderGrid.gridView"
  [loading]="orderGrid.loading"
  [filter]="orderGrid.state.filter"
  [filterable]="true"
  [sort]="orderGrid.state.sort"
  [sortable]="true"
  [groupable]="false"
  [group]="orderGrid.state.group"
  (dataStateChange)="gridDataStateChange($event)"
  (edit)="gridEditHandler($event)"
  (cancel)="gridCancelHandler($event)"
  (remove)="gridRemoveHandler($event)"
  (save)="gridSaveHandler($event)"
>
  <!-- (add)="gridAddHandler($event)" -->
  <ng-template kendoGridToolbarTemplate>
    <!-- <button kendoGridAddCommand [primary]="true">
      [disabled]="!equipmentSelected"
       Add new Order
    </button> -->
    <button kendoButton (click)="openCreateDialog()">Add New Order</button>
  </ng-template>
  <kendo-grid-column field="order.ordernumber">
    <ng-template kendoGridGroupHeaderTemplate let-group="group">
      <span>
        {{ group.value }}
      </span>
    </ng-template>
  </kendo-grid-column>
  <kendo-grid-column field="order.orderdate" title="Order date">
    <ng-template kendoGridCellTemplate let-dataItem>
      {{ dataItem.order.orderdate | date : "dd.MM.yyyy" }}
    </ng-template>
  </kendo-grid-column>
  <kendo-grid-column
    field="order.reseller.name"
    title="Reseller"
  ></kendo-grid-column>
  <kendo-grid-column field="pc.modelname" title="Model"></kendo-grid-column>
  <kendo-grid-column field="quantity" title="Quantity"></kendo-grid-column>
  <kendo-grid-column
    field="additionalparts"
    title="Additional Parts"
    [editable]="false"
  >
    <ng-template kendoGridCellTemplate let-dataItem>
      {{
        dataItem.additionalparts[0] !== undefined
          ? dataItem.additionalparts[0].partname
          : ""
      }}
      {{
        dataItem.additionalparts[1] !== undefined
          ? ", " + dataItem.additionalparts[0].partname
          : ""
      }}
    </ng-template>
  </kendo-grid-column>
  <kendo-grid-command-column [width]="250">
    <ng-template kendoGridCellTemplate let-isNew="isNew" let-dataItem>
      <ng-container>
        <button kendoGridEditCommand [primary]="true">Edit</button>
        <button kendoGridRemoveCommand>Remove</button>
      </ng-container>
      <button
        kendoGridSaveCommand
        [primary]="true"
        [disabled]="!orderGrid.formGroup.valid"
      >
        <!-- [disabled]="grid.formGroup.invalid" -->
        {{ isNew ? "Add" : "Update" }}
      </button>
      <button kendoGridCancelCommand>
        {{ isNew ? "Discard changes" : "Cancel" }}
      </button>
    </ng-template>
  </kendo-grid-command-column>
</kendo-grid>
